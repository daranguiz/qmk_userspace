#include QMK_KEYBOARD_H
#include "dario.h"

#ifdef OLED_ENABLE

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_270;
}

// In 270° rotation: 32 pixels wide × 128 pixels tall
// Display is organized as 16 rows of 32 columns
// Each byte controls 8 vertical pixels

// Simple full-width block letter bitmaps
// Format: 128 bytes total (4 rows × 32 columns)
// Each letter takes up full width and ~24 pixels of height

static const char PROGMEM logo_daa[] = {
    // Row 0 (lines 0-7): Top of "D A"
    0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,

    // Row 1 (lines 8-15): Bottom of "D A"
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,

    // Row 2 (lines 16-23): Top of second "A"
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // Row 3 (lines 24-31): Bottom of second "A"
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

static const char PROGMEM separator[] = {
    // Row 6 (lines 48-55): Separator line
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
};

// Large layer name bitmaps - each letter is ~20-24 pixels tall, full width
// "NAV"
static const char PROGMEM layer_nav[] = {
    // Row 9-10 (lines 72-87): "NAV"
    // N
    0xFF, 0xFF, 0xFF, 0x03, 0x07, 0x1F, 0x7F, 0xFF, 0xFC, 0xF0, 0xC0, 0x00, 0xFF, 0xFF, 0xFF, 0x00,
    // A
    0xFF, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0F, 0x3F, 0xFF, 0xFF, 0xFF, 0x00,
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

// "BAS"
static const char PROGMEM layer_bas[] = {
    0xFF, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0xFF, 0x03, 0x03, 0xFF,
    0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,

    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xFF,
    0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
};

static void render_large_text(void) {
    oled_clear();

    // Render logo (DA / A)
    oled_write_raw_P(logo_daa, sizeof(logo_daa));

    // Render separator
    oled_set_cursor(0, 6);
    oled_write_raw_P(separator, sizeof(separator));

    // Render layer name
    uint8_t layer = get_highest_layer(layer_state);
    oled_set_cursor(0, 9);

    switch (layer) {
        case NAV:
            oled_write_raw_P(layer_nav, sizeof(layer_nav));
            break;
        case BASE:
            oled_write_raw_P(layer_bas, sizeof(layer_bas));
            break;
        default:
            // Fallback to text
            oled_set_cursor(0, 12);
            switch (layer) {
                case MEDIA:  oled_write_P(PSTR("MED"), false); break;
                case NUM:    oled_write_P(PSTR("NUM"), false); break;
                case SYM:    oled_write_P(PSTR("SYM"), false); break;
                case FUN:    oled_write_P(PSTR("FUN"), false); break;
                default:     oled_write_P(PSTR("???"), false);
            }
    }
}

bool oled_task_user(void) {
    render_large_text();
    return false;
}

#endif // OLED_ENABLE
